<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    #alice-text {
      font-size: 12pt;      
      width: 95%;            
      white-space: pre;
      font-family: monospace;
    }
  </style>
</head>

<body>
  <div id="alice-text"></div>
  <script type="module">
    function letterFreq(text){
      let freq = {};
      for(let ch of text){
        ch = ch.toUpperCase();
        if (!ch.match(/[a-zA-Z]/)){
          continue;
        }

        if (ch in freq){
          freq[ch] += 1;
        } else {
          freq[ch] = 1;
        }
      }
      return freq;
    }

    function printFreq(freqDict){
      let sortedArr = Array.from(Object.entries(freqDict))
          .sort((a,b)=>b[1]-a[1]);
      const freqSum = sortedArr
          .map((x)=>x[1])
          .reduce((x,st)=>st += x, 0);

      let hist = "";
      for (let [ch_x, freq_x] of sortedArr.slice(0,20)){
        const ratio = freq_x/freqSum*100;
        hist += `[${ratio.toFixed(2).padStart(5, " ")}] `;
        hist += ch_x + " ";        
        hist += "#".repeat(~~ratio/0.5);        
        hist += "\n";
      }
      return hist;
    }

    let elem = document.querySelector("#alice-text");
    try{
      let resp = await fetch("/lab/web02/alice.txt");      
      let text = await resp.text();      
      let freqDict = letterFreq(text);
      let freqHist = printFreq(freqDict);
      elem.textContent = freqHist;
    } catch (err){
      console.log(err);
    }      
  </script>
</body>
</html>